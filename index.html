<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Numerology — Calcolatore Pitagorico</title>
  <meta name="description" content="App per numerologia pitagorica: percorso di vita, espressione, anima, personalità, anno personale, matrice 3×3 e interpretazione estesa.">
  <style>
    :root{
      --bg:#0f1115; --card:#151823; --ink:#eaeefb; --muted:#9aa3b2; --acc:#7aa2ff; --line:#222738; --ok:#2ecc71; --warn:#f39c12;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;line-height:1.45}
    a{color:var(--acc);text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;padding:12px 0 18px;border-bottom:1px solid var(--line);position:sticky;top:0;background:linear-gradient(180deg, rgba(15,17,21,.97), rgba(15,17,21,.85));backdrop-filter: blur(6px);z-index:2}
    header h1{margin:0;font-size:22px}
    header .sub{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:18px}
    @media(min-width:900px){ .grid{grid-template-columns:1.1fr .9fr} }
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
    .card h2{margin:0 0 10px;font-size:18px}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:14px}
    input[type="text"], input[type="date"], input[type="number"]{
      width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f131b;color:var(--ink);
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    button{
      border:1px solid var(--line);background:#101522;color:var(--ink);
      padding:10px 14px;border-radius:10px;cursor:pointer
    }
    button.primary{background:var(--acc);color:#0a0d14;border-color:#5b84ff}
    .muted{color:var(--muted)}
    .kv{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .kv .item{background:#0f131b;border:1px solid var(--line);border-radius:12px;padding:12px}
    .kv .k{color:var(--muted);font-size:13px}
    .kv .v{font-size:22px;font-weight:600}
    .note{font-size:13px;color:var(--muted)}
    .switch{display:flex;align-items:center;gap:8px;margin-top:8px}
    .switch input{transform:scale(1.2)}
    .matrix{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
    .cell{border:1px solid var(--line);border-radius:10px;padding:10px;text-align:center;background:#0f131b}
    .cell .digit{font-size:12px;color:var(--muted)}
    .cell .count{font-size:26px;font-weight:700;margin-top:2px}
    .legend{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px;font-size:12px;color:var(--muted)}
    .section h3{margin:16px 0 8px;font-size:16px}
    footer{margin:24px 0 8px;color:var(--muted);font-size:12px}
    .hr{height:1px;background:var(--line);margin:14px 0}
    .pre{white-space:pre-wrap;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:#0f131b;border:1px solid var(--line);border-radius:12px;padding:10px;font-size:13px}
    .rich p{margin:.4rem 0}
    .rich .lead{font-weight:600}
    .twocol{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){ .twocol{grid-template-columns:1fr 1fr} }
    @media print{
      header{position:static;background:transparent;border:none}
      .wrap{padding:0}
      .card{page-break-inside:avoid}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Numerology — Calcolatore Pitagorico</h1>
        <div class="sub">Inserisci nome e data di nascita. L'app calcola: Percorso di Vita, Espressione, Anima, Personalità, Matrice 3×3, Anno Personale e una <b>interpretazione estesa</b>.</div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>Dati</h2>
        <label for="fullname">Nome e cognome (battesimo)</label>
        <input id="fullname" type="text" placeholder="Es. Alessandro Pezzali" autocomplete="name"/>

        <div class="row">
          <div>
            <label for="birthdate">Data di nascita</label>
            <input id="birthdate" type="date" />
          </div>
          <div>
            <label for="targetyear">Anno per il calcolo dell'Anno Personale</label>
            <input id="targetyear" type="number" min="1900" max="3000" />
          </div>
        </div>

        <div class="switch">
          <input id="keepMasters" type="checkbox" checked/>
          <label for="keepMasters">Mantieni numeri maestri (11, 22, 33) dove applicabile</label>
        </div>
        <div class="switch">
          <input id="yAsVowel" type="checkbox"/>
          <label for="yAsVowel">Considera Y come vocale</label>
        </div>

        <div class="actions">
          <button class="primary" id="calcBtn">Calcola</button>
          <button id="clearBtn">Pulisci</button>
          <button id="printBtn">Stampa / PDF</button>
        </div>
        <div class="note" style="margin-top:8px">
          Dati solo in locale, nessun invio a server. Metodo pitagorico (A=1…Z=8, ciclo a 9).
        </div>
      </section>

      <section class="card">
        <h2>Risultati Rapidi</h2>
        <div class="kv" id="quick">
          <div class="item"><div class="k">Percorso di Vita</div><div class="v" id="lifePath">—</div></div>
          <div class="item"><div class="k">Espressione (Nome)</div><div class="v" id="expression">—</div></div>
          <div class="item"><div class="k">Anima (Vocali)</div><div class="v" id="soul">—</div></div>
          <div class="item"><div class="k">Personalità (Consonanti)</div><div class="v" id="personality">—</div></div>
          <div class="item"><div class="k">Anno Personale</div><div class="v" id="personalYear">—</div></div>
          <div class="item"><div class="k">Essenza Anno di Nascita</div><div class="v" id="birthYearEssence">—</div></div>
        </div>
      </section>
    </div>

    <section class="card section">
      <h3>Matrice Pitagorica (Quadrato 3×3)</h3>
      <div class="matrix" id="matrix"></div>
      <div class="legend">
        <div>1–2–3: Mente</div>
        <div>4–5–6: Lavoro/Praticità</div>
        <div>7–8–9: Spiritualità</div>
        <div>1–4–7: Volontà</div>
        <div>2–5–8: Emozioni</div>
        <div>3–6–9: Fortuna/Spirito</div>
      </div>
    </section>

    <section class="card section">
      <h3>Interpretazione Estesa</h3>
      <div id="readingRich" class="rich">Inserisci i dati e premi “Calcola”.</div>
    </section>

    <footer>
      Fatto con ♥. Metodo pitagorico semplificato. Questa app non fornisce consulenza professionale; è pensata per uso personale/divertimento.
    </footer>
  </div>

<script>
(function(){
  const meanings = {
    1:"inizio, indipendenza, volontà, leadership",
    2:"cooperazione, diplomazia, sensibilità, ascolto",
    3:"creatività, comunicazione, espressione, gioia",
    4:"ordine, metodo, lavoro, concretezza",
    5:"libertà, versatilità, cambiamento, viaggio",
    6:"responsabilità, famiglia, cura, estetica",
    7:"ricerca, introspezione, studio, spiritualità interiore",
    8:"potere, gestione, denaro, autorevolezza",
    9:"umanità, empatia universale, compassione, ispirazione"
  };

  const mapChar = (ch)=>{
    const c = ch.toUpperCase();
    if(c < 'A' || c > 'Z') return null;
    const code = c.charCodeAt(0) - 64; // A=1
    return ((code - 1) % 9) + 1;
  };

  const isVowel = (ch, yAsVowel)=>{
    const v = "AEIOU" + (yAsVowel ? "Y" : "");
    return v.indexOf(ch.toUpperCase()) !== -1;
  };

  const sumDigits = (n)=> n.toString().split("").reduce((a,b)=> a + (parseInt(b)||0), 0);

  const reduceNumber = (n, keepMasters)=>{
    const masters = new Set([11,22,33]);
    let x = n;
    while(x > 9){
      if(keepMasters && masters.has(x)) return x;
      x = sumDigits(x);
    }
    return x;
  };

  const parseDateDigits = (value)=> value.replaceAll("-","").split("").map(d => parseInt(d)||0);

  const countsToMatrix = (digits)=>{
    const cnt = {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0};
    digits.forEach(d=>{ if(d>=1 && d<=9) cnt[d]++; });
    return cnt;
  };

  const renderMatrix = (cnt)=>{
    const cont = document.getElementById("matrix");
    cont.innerHTML = "";
    [1,2,3,4,5,6,7,8,9].forEach(d=>{
      const el = document.createElement("div");
      el.className = "cell";
      el.innerHTML = `<div class="digit">${d}</div><div class="count">${cnt[d]||0}</div>`;
      cont.appendChild(el);
    });
  };

  const numberBlurb = (n)=>{
    const key = reduceNumber(n,false);
    return meanings[key] ? `${key} → ${meanings[key]}` : `${n}`;
  };

  const buildRichReading = (vals)=>{
    const {
      name, dateVal, keepMasters, yAsVowel,
      lifePath, expression, soul, personality, personalYear, birthYearEssence,
      day, month, year, matrix
    } = vals;

    const strong = Object.keys(matrix).filter(k => matrix[k]>=2).map(Number);
    const missing = Object.keys(matrix).filter(k => matrix[k]==0).map(Number);

    const lineMent = [1,2,3].map(x=>matrix[x]).reduce((a,b)=>a+b,0);
    const lineWork = [4,5,6].map(x=>matrix[x]).reduce((a,b)=>a+b,0);
    const lineSpir = [7,8,9].map(x=>matrix[x]).reduce((a,b)=>a+b,0);
    const colWill  = [1,4,7].map(x=>matrix[x]).reduce((a,b)=>a+b,0);
    const colEmo   = [2,5,8].map(x=>matrix[x]).reduce((a,b)=>a+b,0);
    const colLuck  = [3,6,9].map(x=>matrix[x]).reduce((a,b)=>a+b,0);

    const fmtList = (arr)=> arr.length? arr.join(", ") : "—";

    const parts = [];
    parts.push(`<p class="lead">Analisi per <b>${name}</b>, nato/a il <b>${dateVal.split("-").reverse().join("/")}</b>.</p>`);

    parts.push(`<p><b>Percorso di Vita:</b> <b>${lifePath}</b> (${meanings[reduceNumber(lifePath,false)]||""}). È il “cammino principale”, ottenuto sommando tutte le cifre della data.</p>`);

    parts.push(`<div class="twocol">
      <div><p><b>Giorno di nascita:</b> <b>${day}</b> → ${numberBlurb(day)}. Colora lo stile di partenza, l’ego e l’iniziativa.</p>
      <p><b>Mese:</b> <b>${month}</b> → ${numberBlurb(month)}. Tinge la sensibilità e il rapporto con gli altri.</p></div>
      <div><p><b>Anno (essenza):</b> <b>${birthYearEssence}</b> → ${numberBlurb(birthYearEssence)}. Imprinting generazionale.</p>
      <p><b>Anno Personale:</b> <b>${personalYear}</b> → ${numberBlurb(personalYear)}. Ciclo annuale attivo nell’anno selezionato.</p></div>
    </div>`);

    parts.push(`<div class="hr"></div>`);

    parts.push(`<div class="twocol">
      <div><p><b>Espressione (Nome):</b> <b>${expression}</b> → ${numberBlurb(expression)}. Come appari e che talento porti nel mondo.</p>
      <p><b>Anima (Vocali):</b> <b>${soul}</b> → ${numberBlurb(soul)}. Desiderio interiore, ciò che ti muove.</p></div>
      <div><p><b>Personalità (Consonanti):</b> <b>${personality}</b> → ${numberBlurb(personality)}. Immagine esterna, come vieni percepito.</p>
      <p class="muted">Impostazioni: numeri maestri <b>${keepMasters? "attivi":"disattivi"}</b>; Y come vocale <b>${yAsVowel? "sì":"no"}</b>.</p></div>
    </div>`);

    parts.push(`<div class="hr"></div>`);

    parts.push(`<p><b>Matrice Pitagorica:</b> numeri forti (≥2): <b>${fmtList(strong)}</b>; mancanti: <b>${fmtList(missing)}</b>.</p>`);

    // Commento su linee/colonne
    const commentLine = (label, val)=> `<p>${label}: <b>${val}</b> — ${val===0 ? "area da coltivare" : (val>=3? "linea forte":"equilibrata")}.</p>`;
    parts.push(`<div class="twocol">
      <div>
        ${commentLine("Linea 1–2–3 (Mente)", lineMent)}
        ${commentLine("Linea 4–5–6 (Lavoro/Praticità)", lineWork)}
        ${commentLine("Linea 7–8–9 (Spiritualità)", lineSpir)}
      </div>
      <div>
        ${commentLine("Colonna 1–4–7 (Volontà)", colWill)}
        ${commentLine("Colonna 2–5–8 (Emozioni)", colEmo)}
        ${commentLine("Colonna 3–6–9 (Fortuna/Spirito)", colLuck)}
      </div>
    </div>`);

    // Suggerimenti da numeri mancanti
    if(missing.length){
      const tips = {
        2:"allenare diplomazia e ascolto attivo",
        3:"coltivare espressione creativa e autoironia",
        5:"lavorare su flessibilità e cambiamento",
        7:"dedicare tempo a studio e introspezione",
        8:"imparare gestione di denaro e confini/potere"
      };
      const adv = missing.map(n=> `• ${n}: ${tips[n]||"area da esplorare"}`).join("<br>");
      parts.push(`<p><b>Aree di crescita (mancanze):</b><br>${adv}</p>`);
    }

    parts.push(`<p class="muted">Questa lettura è generata automaticamente con metodo pitagorico semplificato.</p>`);
    return parts.join("\n");
  };

  const renderMatrix = (cnt)=>{
    const cont = document.getElementById("matrix");
    cont.innerHTML = "";
    [1,2,3,4,5,6,7,8,9].forEach(d=>{
      const el = document.createElement("div");
      el.className = "cell";
      el.innerHTML = `<div class="digit">${d}</div><div class="count">${cnt[d]||0}</div>`;
      cont.appendChild(el);
    });
  };

  const compute = ()=>{
    const keepMasters = document.getElementById("keepMasters").checked;
    const yAsVowel = document.getElementById("yAsVowel").checked;
    const name = document.getElementById("fullname").value.trim();
    const dateVal = document.getElementById("birthdate").value;
    const ty = parseInt(document.getElementById("targetyear").value);

    if(!dateVal){ alert("Inserisci la data di nascita."); return; }
    if(!name){ alert("Inserisci nome e cognome."); return; }

    const yyyy = parseInt(dateVal.slice(0,4));
    const mm   = parseInt(dateVal.slice(5,7));
    const dd   = parseInt(dateVal.slice(8,10));

    const dateDigits = parseDateDigits(dateVal);
    const lifePath = reduceNumber(dateDigits.reduce((a,b)=>a+b,0), keepMasters);
    const birthYearEssence = reduceNumber((yyyy+"").split("").reduce((a,b)=>a+parseInt(b),0), keepMasters);
    const targetYear = (!isNaN(ty) && ty>=1900)? ty : (new Date()).getFullYear();
    const personalYear = reduceNumber(
      (dd+"").split("").reduce((a,b)=>a+parseInt(b),0) +
      (mm+"").split("").reduce((a,b)=>a+parseInt(b),0) +
      (targetYear+"").split("").reduce((a,b)=>a+parseInt(b),0),
      false
    );

    const letters = [...name].map(ch => mapChar(ch)).filter(v => v!==null);
    const expression = reduceNumber(letters.reduce((a,b)=>a+b,0), keepMasters);
    const vowels = [...name].filter(ch=> isVowel(ch, yAsVowel)).map(ch => mapChar(ch)).filter(v=>v!==null);
    const soul = reduceNumber(vowels.reduce((a,b)=>a+b,0), keepMasters);
    const consonants = [...name].filter(ch=> !isVowel(ch, yAsVowel)).map(ch => mapChar(ch)).filter(v=>v!==null);
    const personality = reduceNumber(consonants.reduce((a,b)=>a+b,0), keepMasters);

    const matrix = countsToMatrix(dateDigits);

    // Quick UI
    document.getElementById("lifePath").textContent = lifePath;
    document.getElementById("expression").textContent = expression;
    document.getElementById("soul").textContent = soul;
    document.getElementById("personality").textContent = personality;
    document.getElementById("personalYear").textContent = personalYear;
    document.getElementById("birthYearEssence").textContent = birthYearEssence;
    renderMatrix(matrix);

    // Rich reading
    const html = buildRichReading({
      name, dateVal, keepMasters, yAsVowel,
      lifePath, expression, soul, personality, personalYear, birthYearEssence,
      day: reduceNumber(dd,false), month: reduceNumber(mm,false), year: yyyy, matrix
    });
    document.getElementById("readingRich").innerHTML = html;
  };

  const clearAll = ()=>{
    document.getElementById("fullname").value = "";
    document.getElementById("birthdate").value = "";
    document.getElementById("targetyear").value = "";
    document.getElementById("keepMasters").checked = true;
    document.getElementById("yAsVowel").checked = false;
    document.getElementById("lifePath").textContent = "—";
    document.getElementById("expression").textContent = "—";
    document.getElementById("soul").textContent = "—";
    document.getElementById("personality").textContent = "—";
    document.getElementById("personalYear").textContent = "—";
    document.getElementById("birthYearEssence").textContent = "—";
    document.getElementById("matrix").innerHTML = "";
    document.getElementById("readingRich").textContent = "Inserisci i dati e premi “Calcola”.";
  };

  // init
  const now = new Date();
  document.getElementById("targetyear").value = now.getFullYear();
  renderMatrix({1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0});

  document.getElementById("calcBtn").addEventListener("click", compute);
  document.getElementById("clearBtn").addEventListener("click", clearAll);
  document.getElementById("printBtn").addEventListener("click", ()=> window.print());
})();
</script>
</body>
</html>
