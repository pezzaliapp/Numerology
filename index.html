<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Numerology ‚Äî Calcolatore Pitagorico</title>
  <meta name="description" content="App per numerologia pitagorica con interpretazione estesa: presenti/mancanti, linee della matrice, sintesi.">
  <style>
    :root{
      --bg:#0f1115; --card:#151823; --ink:#eaeefb; --muted:#9aa3b2; --acc:#7aa2ff; --line:#222738;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;line-height:1.45}
    a{color:var(--acc);text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;padding:12px 0 18px;border-bottom:1px solid var(--line);position:sticky;top:0;background:linear-gradient(180deg, rgba(15,17,21,.97), rgba(15,17,21,.85));backdrop-filter: blur(6px);z-index:2}
    header h1{margin:0;font-size:22px}
    header .sub{color:var(--muted);font-size:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:18px}
    @media(min-width:900px){ .grid{grid-template-columns:1.1fr .9fr} }
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
    .card h2{margin:0 0 10px;font-size:18px}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:14px}
    input[type="text"], input[type="date"], input[type="number"]{
      width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f131b;color:var(--ink);
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    button{
      border:1px solid var(--line);background:#101522;color:var(--ink);
      padding:10px 14px;border-radius:10px;cursor:pointer
    }
    button.primary{background:#7aa2ff;color:#0a0d14;border-color:#5b84ff}
    .muted{color:var(--muted)}
    .kv{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .kv .item{background:#0f131b;border:1px solid var(--line);border-radius:12px;padding:12px}
    .kv .k{color:var(--muted);font-size:13px}
    .kv .v{font-size:22px;font-weight:600}
    .note{font-size:13px;color:var(--muted)}
    .switch{display:flex;align-items:center;gap:8px;margin-top:8px}
    .switch input{transform:scale(1.2)}
    .matrix{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
    .cell{border:1px solid var(--line);border-radius:10px;padding:10px;text-align:center;background:#0f131b}
    .cell .digit{font-size:12px;color:var(--muted)}
    .cell .count{font-size:26px;font-weight:700;margin-top:2px}
    .legend{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px;font-size:12px;color:var(--muted)}
    .section h3{margin:16px 0 8px;font-size:16px}
    footer{margin:24px 0 8px;color:var(--muted);font-size:12px}
    .hr{height:1px;background:var(--line);margin:14px 0}
    .rich p{margin:.4rem 0}
    .rich .lead{font-weight:600}
    ul{margin:.4rem 0 .6rem 1rem}
    .twocol{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){ .twocol{grid-template-columns:1fr 1fr} }
    .copybar{display:flex;gap:8px;align-items:center;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Numerology ‚Äî Calcolatore Pitagorico</h1>
        <div class="sub">Interpretazione completa: Percorso, Nome (Espressione/Anima/Personalit√†), Matrice 3√ó3, Linee/Colonne, presenti e mancanti.</div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>Dati</h2>
        <label for="fullname">Nome e cognome (battesimo)</label>
        <input id="fullname" type="text" placeholder="Es. Alessandro Pezzali" autocomplete="name"/>

        <div class="row">
          <div>
            <label for="birthdate">Data di nascita</label>
            <input id="birthdate" type="date" />
          </div>
          <div>
            <label for="targetyear">Anno per il calcolo dell'Anno Personale</label>
            <input id="targetyear" type="number" min="1900" max="3000" />
          </div>
        </div>

        <div class="switch">
          <input id="keepMasters" type="checkbox" checked/>
          <label for="keepMasters">Mantieni numeri maestri (11, 22, 33) dove applicabile</label>
        </div>
        <div class="switch">
          <input id="yAsVowel" type="checkbox"/>
          <label for="yAsVowel">Considera Y come vocale</label>
        </div>

        <div class="actions">
          <button class="primary" id="calcBtn">Calcola</button>
          <button id="clearBtn">Pulisci</button>
          <button id="printBtn">Stampa / PDF</button>
          <button id="copyBtn">Copia interpretazione</button>
        </div>
        <div class="note" style="margin-top:8px">
          Dati solo in locale, nessun invio a server. Metodo pitagorico (A=1‚Ä¶Z=8, ciclo a 9).
        </div>
      </section>

      <section class="card">
        <h2>Risultati Rapidi</h2>
        <div class="kv" id="quick">
          <div class="item"><div class="k">Percorso di Vita</div><div class="v" id="lifePath">‚Äî</div></div>
          <div class="item"><div class="k">Espressione (Nome)</div><div class="v" id="expression">‚Äî</div></div>
          <div class="item"><div class="k">Anima (Vocali)</div><div class="v" id="soul">‚Äî</div></div>
          <div class="item"><div class="k">Personalit√† (Consonanti)</div><div class="v" id="personality">‚Äî</div></div>
          <div class="item"><div class="k">Anno Personale</div><div class="v" id="personalYear">‚Äî</div></div>
          <div class="item"><div class="k">Essenza Anno di Nascita</div><div class="v" id="birthYearEssence">‚Äî</div></div>
        </div>
      </section>
    </div>

    <section class="card section">
      <h3>Matrice Pitagorica (Quadrato 3√ó3)</h3>
      <div class="matrix" id="matrix"></div>
      <div class="legend">
        <div>1‚Äì2‚Äì3: Mente</div>
        <div>4‚Äì5‚Äì6: Lavoro/Praticit√†</div>
        <div>7‚Äì8‚Äì9: Spiritualit√†</div>
        <div>1‚Äì4‚Äì7: Volont√†</div>
        <div>2‚Äì5‚Äì8: Emozioni</div>
        <div>3‚Äì6‚Äì9: Fortuna/Spirito</div>
      </div>
    </section>

    <section class="card section">
      <h3>Interpretazione Estesa</h3>
      <div id="readingRich" class="rich">Inserisci i dati e premi ‚ÄúCalcola‚Äù.</div>
    </section>

    <footer>
      Fatto con ‚ô•. Metodo pitagorico semplificato. Questa app non fornisce consulenza professionale; √® pensata per uso personale/divertimento.
    </footer>
  </div>

<script>
(function(){
  const meanings = {
    1:"inizio, indipendenza, volont√†, leadership",
    2:"cooperazione, diplomazia, sensibilit√†, ascolto",
    3:"creativit√†, comunicazione, espressione, gioia",
    4:"ordine, metodo, lavoro, concretezza",
    5:"libert√†, versatilit√†, cambiamento, viaggio",
    6:"responsabilit√†, famiglia, cura, estetica",
    7:"ricerca, introspezione, studio, spiritualit√† interiore",
    8:"potere, gestione, denaro, autorevolezza",
    9:"umanit√†, empatia universale, compassione, ispirazione"
  };

  const presentTexts = {
    1:"Forte ego, determinazione, individualismo. Capacit√† di leadership. Talvolta testardaggine.",
    2:"Cooperazione, diplomazia, tatto; sensibilit√† alle dinamiche relazionali.",
    3:"Creativit√†, comunicazione, espressione artistica; leggerezza e gioia.",
    4:"Concretezza, senso pratico, capacit√† di costruire e organizzare.",
    5:"Versatilit√†, adattamento, desiderio di cambiamento e movimento.",
    6:"Responsabilit√†, famiglia, sensibilit√† verso i doveri.",
    7:"Introspezione, ricerca della verit√†, studio e profondit√†.",
    8:"Gestione, autorevolezza, orientamento al risultato e alle risorse.",
    9:"Spiritualit√†, altruismo, umanit√† e profondit√† interiore; vocazione universale."
  };

  const missingTexts = {
    2:"Mancanza di diplomazia naturale: bisogna lavorare su collaborazione e ascolto degli altri.",
    3:"Mancanza di leggerezza e autoironia spontanea: il ‚Äúgioco‚Äù va coltivato volontariamente.",
    5:"Mancanza di versatilit√† innata: bisogna sviluppare flessibilit√† e capacit√† di adattamento.",
    7:"Mancanza di introspezione automatica: la saggezza si costruisce pi√π con l‚Äôesperienza che con l‚Äôisolamento.",
    8:"Mancanza di potere materiale innato: l‚Äôautorit√† e la gestione del denaro si imparano, non vengono di default."
  };

  const mapChar = (ch)=>{
    const c = ch.toUpperCase();
    if(c < 'A' || c > 'Z') return null;
    const code = c.charCodeAt(0) - 64; // A=1
    return ((code - 1) % 9) + 1;
  };

  const isVowel = (ch, yAsVowel)=>{
    const v = "AEIOU" + (yAsVowel ? "Y" : "");
    return v.indexOf(ch.toUpperCase()) !== -1;
  };

  const sumDigits = (n)=> n.toString().split("").reduce((a,b)=> a + (parseInt(b)||0), 0);

  const reduceNumber = (n, keepMasters)=>{
    const masters = new Set([11,22,33]);
    let x = n;
    while(x > 9){
      if(keepMasters && masters.has(x)) return x;
      x = sumDigits(x);
    }
    return x;
  };

  const parseDateDigits = (value)=> value.split("-").join("").split("").map(d => parseInt(d)||0);

  const countsToMatrix = (digits)=>{
    const cnt = {1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0};
    digits.forEach(d=>{ if(d>=1 && d<=9) cnt[d]++; });
    return cnt;
  };

  const renderMatrix = (cnt)=>{
    const cont = document.getElementById("matrix");
    cont.innerHTML = "";
    [1,2,3,4,5,6,7,8,9].forEach(d=>{
      const el = document.createElement("div");
      el.className = "cell";
      el.innerHTML = `<div class="digit">${d}</div><div class="count">${cnt[d]||0}</div>`;
      cont.appendChild(el);
    });
  };

  const numberBlurb = (n)=>{
    const key = reduceNumber(n,false);
    return meanings[key] ? `${key} ‚Üí ${meanings[key]}` : `${n}`;
  };

  const li = (t)=> `<li>${t}</li>`;

  const buildInterpretationBlocks = (cnt)=>{
    const present = [];
    for(let d=1; d<=9; d++){
      if(cnt[d] > 0){
        const lab = cnt[d] >= 2 ? `${d} (doppio)` : `${d}`;
        present.push(li(`<b>${lab}</b> ‚Üí ${presentTexts[d]||""}`));
      }
    }
    const missing = [];
    for(let d of [2,3,5,7,8]){ // solo quelli con testo dedicato
      if(cnt[d] === 0){
        missing.push(li(`<b>${d}</b> ‚Üí ${missingTexts[d]}`));
      }
    }
    return `<p>üîÆ <b>Interpretazione</b></p>
    <p><b>‚úÖ Numeri presenti</b></p><ul>${present.join("")||li("‚Äî")}</ul>
    <p><b>‚ùå Numeri mancanti</b></p><ul>${missing.join("")||li("‚Äî")}</ul>`;
  };

  const buildLinesNarrative = (cnt)=>{
    const sum = arr => arr.reduce((a,b)=>a+(cnt[b]||0),0);
    const line1 = sum([1,2,3]);
    const line2 = sum([4,5,6]);
    const line3 = sum([7,8,9]);
    const col1  = sum([1,4,7]);
    const col2  = sum([2,5,8]);
    const col3  = sum([3,6,9]);

    const d = (n)=> cnt[n]>0;
    const item = (label, text)=> li(`<b>${label}</b> ‚Üí ${text}`);

    const t1 = (d(1)&&!d(2)&&!d(3)) ? "Solo il 1, mancano 2 e 3 ‚Üí forte iniziativa personale ma serve imparare la mediazione e il gioco mentale."
              : (line1===0?"vuota":(line1>=3?"linea forte":"equilibrata"));

    const t2 = (d(4)&&d(6)&&!d(5)) ? "Presenti 4 e 6, manca il 5 ‚Üí buona struttura e responsabilit√†, ma serve flessibilit√†."
              : (line2===0?"vuota":(line2>=3?"linea forte":"equilibrata"));

    const t3 = (d(9)&&!d(7)&&!d(8)) ? "Presente solo il 9 ‚Üí tanta spiritualit√†, ma rischia di essere ‚Äúsbilanciata‚Äù senza radici materiali."
              : (line3===0?"vuota":(line3>=3?"linea forte":"equilibrata"));

    const c1 = (d(1)&&d(4)&&!d(7)) ? "Presenti 1 e 4, manca 7 ‚Üí tanta volont√† e pragmatismo, ma poca introspezione."
              : (col1===0?"vuota":(col1>=3?"colonna forte":"equilibrata"));

    const c2 = (!d(2)&&!d(5)&&!d(8)) ? "Completamente vuota ‚Üí area debole: bisogna lavorare su emozioni, empatia pratica e rapporto diretto con le persone."
              : (col2===0?"vuota":(col2>=3?"colonna forte":"equilibrata"));

    const c3 = (d(6)&&d(9)) ? "Presenti 6 e 9 ‚Üí linea forte: sensibilit√†, destino spirituale e protezione nelle situazioni difficili."
              : (col3===0?"vuota":(col3>=3?"colonna forte":"equilibrata"));

    return `<p>üåü <b>Linee della matrice</b></p><ul>
      ${item("Linea orizzontale 1‚Äì2‚Äì3 (Mente)", t1)}
      ${item("Linea orizzontale 4‚Äì5‚Äì6 (Lavoro/Praticit√†)", t2)}
      ${item("Linea orizzontale 7‚Äì8‚Äì9 (Spiritualit√†)", t3)}
      ${item("Linea verticale 1‚Äì4‚Äì7 (Volont√†)", c1)}
      ${item("Linea verticale 2‚Äì5‚Äì8 (Emozioni)", c2)}
      ${item("Linea verticale 3‚Äì6‚Äì9 (Fortuna/Spiritualit√†)", c3)}
    </ul>`;
  };

  const buildSynthesis = (cnt, dateStr)=>{
    const has = n => cnt[n]>0;
    const dbl = n => cnt[n]>=2;
    const bullets = [];

    const strong = [];
    if(dbl(1)) strong.push("Forza personale (doppio 1)");
    if(dbl(9)) strong.push("Vocazione spirituale (doppio 9)");
    const roots = [4,6].filter(has);
    if(roots.length) strong.push(`Radici pratiche (${roots.join(" e ")})`);
    if(strong.length) bullets.push("‚Ä¢ " + strong.join(", ") + ".");

    const lacks = [2,5,8].filter(n=>!has(n));
    if(lacks.length){
      bullets.push(`‚Ä¢ Lacune emotive e relazionali (manca ${lacks.join("-")}) ‚Üí lezioni su relazioni, adattamento e gestione del potere/denaro.`);
    }

    bullets.push("‚Ä¢ Quadro complessivo: iniziativa + senso pratico + responsabilit√† + profondit√† spirituale, bilanciati da un lavoro costante su relazioni e adattabilit√†.");

    return `<p>üß≠ <b>Sintesi della Matrice</b></p>
    <p>La tua data ${dateStr} mostra:</p>
    <ul><li>${bullets.join("</li><li>")}</li></ul>`;
  };

  const compute = ()=>{
    const keepMasters = document.getElementById("keepMasters").checked;
    const yAsVowel = document.getElementById("yAsVowel").checked;
    const name = document.getElementById("fullname").value.trim();
    const dateVal = document.getElementById("birthdate").value;
    const ty = parseInt(document.getElementById("targetyear").value);

    if(!dateVal){ alert("Inserisci la data di nascita."); return; }
    if(!name){ alert("Inserisci nome e cognome."); return; }

    const yyyy = parseInt(dateVal.slice(0,4));
    const mm   = parseInt(dateVal.slice(5,7));
    const dd   = parseInt(dateVal.slice(8,10));

    const dateDigits = parseDateDigits(dateVal);
    const lifePath = reduceNumber(dateDigits.reduce((a,b)=>a+b,0), keepMasters);
    const birthYearEssence = reduceNumber((yyyy+"").split("").reduce((a,b)=>a+parseInt(b),0), keepMasters);
    const targetYear = (!isNaN(ty) && ty>=1900)? ty : (new Date()).getFullYear();
    const personalYear = reduceNumber(
      (dd+"").split("").reduce((a,b)=>a+parseInt(b),0) +
      (mm+"").split("").reduce((a,b)=>a+parseInt(b),0) +
      (targetYear+"").split("").reduce((a,b)=>a+parseInt(b),0),
      false
    );

    const letters = [...name].map(ch => mapChar(ch)).filter(v => v!==null);
    const expression = reduceNumber(letters.reduce((a,b)=>a+b,0), keepMasters);
    const vowels = [...name].filter(ch=> isVowel(ch, yAsVowel)).map(ch => mapChar(ch)).filter(v=>v!==null);
    const soul = reduceNumber(vowels.reduce((a,b)=>a+b,0), keepMasters);
    const consonants = [...name].filter(ch=> !isVowel(ch, yAsVowel)).map(ch => mapChar(ch)).filter(v=>v!==null);
    const personality = reduceNumber(consonants.reduce((a,b)=>a+b,0), keepMasters);

    const matrix = countsToMatrix(dateDigits);

    document.getElementById("lifePath").textContent = lifePath;
    document.getElementById("expression").textContent = expression;
    document.getElementById("soul").textContent = soul;
    document.getElementById("personality").textContent = personality;
    document.getElementById("personalYear").textContent = personalYear;
    document.getElementById("birthYearEssence").textContent = birthYearEssence;
    renderMatrix(matrix);

    const dateShown = dateVal.split("-").reverse().join("/");
    const parts = [];
    parts.push(`<p class="lead">Analisi per <b>${name}</b>, nato/a il <b>${dateShown}</b>.</p>`);
    parts.push(`<p><b>Percorso di Vita:</b> <b>${lifePath}</b> (${meanings[reduceNumber(lifePath,false)]||""}).</p>`);
    parts.push(`<div class="twocol">
      <div><p><b>Giorno di nascita:</b> <b>${reduceNumber(dd,false)}</b> ‚Üí ${numberBlurb(dd)}.</p>
      <p><b>Mese:</b> <b>${reduceNumber(mm,false)}</b> ‚Üí ${numberBlurb(mm)}.</p></div>
      <div><p><b>Anno (essenza):</b> <b>${birthYearEssence}</b> ‚Üí ${numberBlurb(birthYearEssence)}.</p>
      <p><b>Anno Personale:</b> <b>${personalYear}</b> ‚Üí ${numberBlurb(personalYear)}.</p></div>
    </div>`);
    parts.push(`<div class="hr"></div>`);
    parts.push(`<div class="twocol">
      <div><p><b>Espressione (Nome):</b> <b>${expression}</b> ‚Üí ${numberBlurb(expression)}.</p>
      <p><b>Anima (Vocali):</b> <b>${soul}</b> ‚Üí ${numberBlurb(soul)}.</p></div>
      <div><p><b>Personalit√† (Consonanti):</b> <b>${personality}</b> ‚Üí ${numberBlurb(personality)}.</p>
      <p class="muted">Impostazioni: numeri maestri <b>${keepMasters? "attivi":"disattivi"}</b>; Y come vocale <b>${yAsVowel? "s√¨":"no"}</b>.</p></div>
    </div>`);
    parts.push(`<div class="hr"></div>`);
    parts.push(buildInterpretationBlocks(matrix));
    parts.push(`<div class="hr"></div>`);
    parts.push(buildLinesNarrative(matrix));
    parts.push(`<div class="hr"></div>`);
    parts.push(buildSynthesis(matrix, dateShown));

    const el = document.getElementById("readingRich");
    el.innerHTML = parts.join("\n");
    // Store plain text for "copy"
    window.__lastInterpretationText = el.innerText;
  };

  const clearAll = ()=>{
    document.getElementById("fullname").value = "";
    document.getElementById("birthdate").value = "";
    document.getElementById("targetyear").value = "";
    document.getElementById("keepMasters").checked = true;
    document.getElementById("yAsVowel").checked = false;
    document.getElementById("lifePath").textContent = "‚Äî";
    document.getElementById("expression").textContent = "‚Äî";
    document.getElementById("soul").textContent = "‚Äî";
    document.getElementById("personality").textContent = "‚Äî";
    document.getElementById("personalYear").textContent = "‚Äî";
    document.getElementById("birthYearEssence").textContent = "‚Äî";
    document.getElementById("matrix").innerHTML = "";
    document.getElementById("readingRich").textContent = "Inserisci i dati e premi ‚ÄúCalcola‚Äù.";
    window.__lastInterpretationText = "";
  };

  const copyInterpretation = async ()=>{
    try{
      const txt = (window.__lastInterpretationText || document.getElementById("readingRich").innerText || "").trim();
      if(navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(txt);
      }else{
        const ta = document.createElement("textarea");
        ta.value = txt;
        ta.style.position="fixed"; ta.style.opacity="0"; ta.style.left="-9999px";
        document.body.appendChild(ta);
        ta.focus(); ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
      alert("Interpretazione copiata negli appunti.");
    }catch(e){
      alert("Copia non riuscita. Puoi selezionare e copiare manualmente il testo.");
    }
  };

  // init
  const now = new Date();
  document.getElementById("targetyear").value = now.getFullYear();
  renderMatrix({1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0});

  document.getElementById("calcBtn").addEventListener("click", compute);
  document.getElementById("clearBtn").addEventListener("click", clearAll);
  document.getElementById("printBtn").addEventListener("click", ()=> window.print());
  document.getElementById("copyBtn").addEventListener("click", copyInterpretation);
})();
</script>
</body>
</html>
